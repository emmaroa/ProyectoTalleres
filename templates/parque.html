{% extends "layout.html" %}
{% block title %}Parque vehicular · Gestión Talleres{% endblock %}
{% block content %}
<!-- 
<div class="table-toolbar">
  <div class="search">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M11 4a7 7 0 1 1 0 14a7 7 0 0 1 0-14Zm10 18l-5.2-5.2" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/></svg>
    <input type="search" placeholder="Buscar..." data-table-search="#tabla-parque">
  </div>
<div class="filters">
  <div class="chips" data-chips-dep="#tabla-parque"></div>
  <div class="chips" data-chips-status="#tabla-parque"></div>
  <div class="row">
    <div class="field">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 12h16" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/></svg>
      <input type="date" placeholder="Desde" data-date-from="#tabla-parque">
    </div>
    <div class="field">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 12h16" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/></svg>
      <input type="date" placeholder="Hasta" data-date-to="#tabla-parque">
    </div>
    <div class="actions">
      <button class="btn btn-muted" onclick="const p=new URLSearchParams(location.search);['dep','status','from','to','q'].forEach(k=>p.delete(k)); history.replaceState(null,'',location.pathname); applyAllFilters();">Limpiar filtros</button>
    </div>
  </div>
</div>

  <div class="btn-group">
    <button class="btn" data-export-csv="#tabla-parque" data-filename="tabla-parque">Exportar CSV</button>
    <button class="btn btn-outline" onclick="document.getElementById('tabla-parque').classList.toggle('dense')">Densidad</button>
  </div>
</div>
-->
<header>
        <h1>Consulta de Parque Vehicular</h1>
    </header>


    <div class="main-screen" id="mainScreen">
        <h2>Buscar Número Económico</h2>
        <input type="text" id="searchBox" placeholder="Escribe el Número Económico o Patrulla...">
        <div class="table-wrap"><table id="tabla-parque" class="data-table data-table" id="tabla-parque">
            <thead>
                <tr>
                    <th>Número Económico</th>
                    <th>Descripción</th>
                    <th>Dependencia</th>
                </tr>
            </thead>
            <tbody id="dataTable"></tbody>
        </table></div>
    </div>

    <script>
         const apiKey = 'AIzaSyDM8m9-bZM2stDAt1V0i-H-iStD0Vi6Z7k';
        const sheetId = '1jjWtlbLhO4BGqGJKWyXneb4r2WbcFBqDDcb9rEh8J8c';
        const range = 'A1:C'; 
        const apiUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`;


   
        async function fetchData() {
            try {
                const response = await fetch(apiUrl);
                const data = await response.json();
                return data.values || [];
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

     
        function renderTable(data) {
            const table = document.getElementById('dataTable');
            table.innerHTML = '';  
            data.forEach(row => {
                const tr = document.createElement('tr');
                row.forEach(cell => {
                    const td = document.createElement('td');
                    td.textContent = cell;
                    tr.appendChild(td);
                });
                table.appendChild(tr);
            });
        }

    
        function searchTable(query, data) {
            return data.filter(row => row[0].toLowerCase().includes(query.toLowerCase()));
        }

        document.getElementById('searchBox').addEventListener('input', async (event) => {
            const query = event.target.value;
            const allData = await fetchData();
            const filteredData = searchTable(query, allData.slice(1)); 
            renderTable(filteredData);
        });

        (async function init() {
            const allData = await fetchData();
            renderTable(allData.slice(1)); 
        })();
    </script>
{% if session.get('role') == 'admin' and 'parque.html' == 'index.html' %}
<hr>
<h3>Admin rápido: crear usuario</h3>
<form class="inline" method="post" action="{{ url_for('create_user') }}">
  <input name="username" placeholder="nuevo usuario" required>
  <input name="password" placeholder="contraseña" required>
  <select name="role">
    <option value="lectura">lectura</option>
    <option value="captura">captura</option>
    <option value="admin">admin</option>
  </select>
  <button type="submit">Crear</button>
</form>
{% endif %}
{% endblock %}
